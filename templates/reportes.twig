{% extends 'layoutLogueado.twig' %}

{% block titulo %} Reportes {% endblock %}

{% block cuerpo %}
<div class="container mt-3">
  <div class="row justify-content-center">
    <div class="col">
      <div id="grafico" class="container"></div>
    </div>
  </div>
  <div class="form-row justify-content-center mt-2">
      <div class="col-md-auto mt-1 pr-md-0">
        <label for="agrupar">Agrupar por:</label>
      </div>
      <div class="col-md-5 mb-2">
        <select class="custom-select" id="agrupar" >
          <option value="motivo" selected>Motivo</option>
          <option value="genero">Genero</option>
          <option value="localidad">Localidad</option>
        </select>
      </div>
  </div>
  <div class="row justify-content-end">
    <a href="?action=pdfConsultas" target="_blank" class="btn btn-outline-primary">Descargar PDF</a>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="templates/js/highcharts.src.js"></script>
<script src="templates/js/chartExporting.js"></script>
<script>
var porMotivo = [
  {% for porcentajeMotivo in porcentajesMotivo %}
    {
      name: "{{ porcentajeMotivo.nombre }}",
      y: {{ porcentajeMotivo.porcentaje }},
    },
  {%else%}
    {
      name: "No hay consultas para mostrar",
      y: 100,
    }
  {% endfor %}
]
var porGenero = [
  {% for porcentajeGenero in porcentajesGenero %}
    {
      name: "{{ porcentajeGenero.nombre }}",
      y: {{ porcentajeGenero.porcentaje }},
    },
  {%else%}
    {
      name: "No hay consultas para mostrar",
      y: 100,
    }
  {% endfor %}
]
var porLocalidad = [
  {% for porcentajeLocalidad in porcentajesLocalidad %}
    {
      name: "{{ porcentajeLocalidad.nombre }}",
      y: {{ porcentajeLocalidad.porcentaje }},
    },
  {%else%}
    {
      name: "No hay consultas para mostrar",
      y: 100,
    }
  {% endfor %}
]

var agruparPor = {
  motivo: porMotivo,
  genero: porGenero,
  localidad: porLocalidad
}

var chart1 = Highcharts.chart('grafico', {

    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },

    title: {
        text: 'Reportes de consultas agrupadas por motivo'
    },

    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },

    plotOptions: {
        pie: {
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },

    series: [{
        name: 'porcentaje',
        size: 150,
        colorByPoint: true,
        data: agruparPor.motivo
    }],

    exporting:{
      filename: 'reporte'
    }
});

function actualizarGrafico() {
  var tipo = this.value;

  chart1.update({
    series: [{
      name: 'procentaje',
      size: 150,
      colorByPoint: true,
      data: agruparPor[tipo]
    }],
    title: {
      text: ('Reportes de consultas agrupadas por ' + tipo)
    },
  });
}

$("#agrupar").bind('change',actualizarGrafico);
</script>
{% endblock %}
